apiVersion: v1
kind: Pod
metadata:
  name: artifact-backup-dev
  labels:
    app: artifact
    component: backup
spec:
  serviceAccountName: artifact-backup
  restartPolicy: Never
  dnsPolicy: ClusterFirstWithHostNet
  containers:
    - name: artifact-backup
      image: reg.1u1.it/okdaas/artifact-backup:0.1.14
      imagePullPolicy: Always
      stdin: true 
      tty: true 
      env:
        - name: BUCKET
          value: artifact-backups
        - name: S3ENDPOINT
          value: https://s3-de-central.profitbricks.com
        - name: AWS_ACCESS_KEY_ID
          valueFrom:
            secretKeyRef:
              name: s3credentials
              key: aws_access_key_id
        - name: AWS_SECRET_ACCESS_KEY
          valueFrom:
            secretKeyRef:
              name: s3credentials
              key: aws_secret_access_key
        - name: HTTP_PROXY
          value: http://itproxy.1and1.org:3128
        - name: HTTPS_PROXY
          value: http://itproxy.1and1.org:3128
      command:
        - /bin/sh
      volumeMounts:
        - name: sshrsapubkey
          mountPath: "/etc/ssh/"
          readOnly: true
      resources:
        requests:
          memory: "128Mi"
          cpu: "500m"
        limits:
          memory: "512Mi"
          cpu: "4000m"
  volumes:
    - name: sshrsapubkey
      secret:
        secretName: cluster-ssh-key-pub